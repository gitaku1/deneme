import os
import nbformat
from nbconvert import HTMLExporter
from weasyprint import HTML

# Ayarlar
IPYNB_PATH = "/veri01/ipynbdirectory/notebook.ipynb"
PDF_OUTPUT_PATH = "/veri01/ipynbdirectory/notebook.pdf"

# KÃ¼Ã§Ã¼k ve sÄ±ÄŸdÄ±rÄ±lmÄ±ÅŸ Ã¶zel CSS
CUSTOM_CSS = """
<style>
body {
    font-family: "DejaVu Sans", sans-serif;
    font-size: 9pt;
    margin: 0;
    padding: 0;
}
.output_area pre {
    white-space: pre-wrap !important;
    word-wrap: break-word;
    overflow-x: auto;
    font-size: 7pt;
    max-width: 100%;
}
table {
    width: 100% !important;
    table-layout: fixed;
    word-wrap: break-word;
    font-size: 7pt;
}
td, th {
    padding: 2px;
    overflow: hidden;
    text-overflow: ellipsis;
}
code {
    font-size: 7pt;
    word-break: break-word;
}
div.output_scroll {
    overflow: visible !important;
    max-height: none !important;
}
.output_wrapper, .output {
    page-break-inside: avoid;
}
</style>
"""

def convert_full_notebook():
    print("ðŸ“˜ Notebook okunuyor...")
    with open(IPYNB_PATH, "r", encoding="utf-8") as f:
        nb = nbformat.read(f, as_version=4)

    print("ðŸ’» HTML'e dÃ¶nÃ¼ÅŸtÃ¼rÃ¼lÃ¼yor...")
    html_exporter = HTMLExporter()
    html_exporter.exclude_input_prompt = True
    html_exporter.exclude_output_prompt = True
    body, _ = html_exporter.from_notebook_node(nb)

    # CSS ekle
    full_html = CUSTOM_CSS + body

    print("ðŸ“„ PDF oluÅŸturuluyor, bu iÅŸlem birkaÃ§ dakika sÃ¼rebilir...")
    HTML(string=full_html).write_pdf(PDF_OUTPUT_PATH)
    print(f"âœ… PDF baÅŸarÄ±yla oluÅŸturuldu: {PDF_OUTPUT_PATH}")

convert_full_notebook()
