import os
import time
from huggingface_hub import snapshot_download
from huggingface_hub.utils import HfHubHTTPError

# ======================
# Environment variables
# ======================
os.environ["HF_HUB_ENABLE_HF_TRANSFER"] = "1"

# ======================
# User inputs
# ======================
MODEL_ID = input("Enter model repo id (example: meta-llama/Llama-2-7b): ").strip()
LOCAL_DIR = input("Enter local download directory: ").strip()

RETRY_WAIT_SECONDS = 60  # wait time before retry

print(f"Starting model download: {MODEL_ID}")

while True:
    try:
        snapshot_download(
            repo_id=MODEL_ID,
            local_dir=LOCAL_DIR,
            local_dir_use_symlinks=False,
            resume_download=True,
        )

        print("Model download completed successfully.")
        break

    except HfHubHTTPError as e:
        print("HF Hub HTTP error occurred:")
        print(e)
        print(f"Retrying in {RETRY_WAIT_SECONDS} seconds...")
        time.sleep(RETRY_WAIT_SECONDS)

    except Exception as e:
        print("Unexpected error occurred:")
        print(e)
        print(f"Retrying in {RETRY_WAIT_SECONDS} seconds...")
        time.sleep(RETRY_WAIT_SECONDS)
