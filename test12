import dataiku

# Initialize DSS API client
client = dataiku.api_client()

# Get general settings
settings = client.get_general_settings()
raw_settings = settings.get_raw()

SEARCH = "clustera"

found_items = []


def scan_obj(obj, path="root"):
    """
    Recursively scan dict/list objects
    and collect string values containing SEARCH
    """

    if isinstance(obj, dict):
        for k, v in obj.items():
            scan_obj(v, f"{path}.{k}")

    elif isinstance(obj, list):
        for i, v in enumerate(obj):
            scan_obj(v, f"{path}[{i}]")

    elif isinstance(obj, str):
        if SEARCH in obj:
            found_items.append((path, obj))


# Scan only container execution configs
exec_configs = (
    raw_settings
    .get("containerSettings", {})
    .get("executionConfigs", [])
)

for i, cfg in enumerate(exec_configs):
    scan_obj(cfg, f"executionConfigs[{i}]")


# Print results
print("\n=== FOUND PATHS CONTAINING 'clustera' ===\n")

for path, value in found_items:
    print(f"PATH  : {path}")
    print(f"VALUE : {value}")
    print("-" * 60)

print(f"\nTotal matches found: {len(found_items)}")
