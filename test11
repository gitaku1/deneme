#!/bin/bash

BASE_URL="https://<ARTIFACTORY_URL>/artifactory/<REPO>/<PATH>"
USER="username"
PASS="password"

total=0

# Read all URLs from filelist.txt
while read manifest_url; do
    # Only process files starting with manifest-sha256
    if [[ "$manifest_url" == *manifest-sha256* ]]; then
        size_sum=$(curl -s -u $USER:$PASS "$manifest_url" \
            | grep -o '"size":[0-9]\+' \
            | awk -F: '{s+=$2} END {print s}')
        
        # Add to total if not empty
        if [[ -n "$size_sum" ]]; then
            total=$((total + size_sum))
        fi
    fi
done < filelist.txt

# Convert bytes to GB and print
echo "Total: $(awk -v b=$total 'BEGIN{printf \"%.2f GB\n\", b/1024/1024/1024}')"
