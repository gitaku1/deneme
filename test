import nbformat
from nbconvert import HTMLExporter
from weasyprint import HTML
import os

IPYNB_PATH = "/veri01/ipynbdirectory/notebook.ipynb"
HTML_PATH = "/veri01/ipynbdirectory/notebook.html"
PDF_PATH = "/veri01/ipynbdirectory/notebook.pdf"

# Notebook'u oku
with open(IPYNB_PATH, "r", encoding="utf-8") as f:
    notebook = nbformat.read(f, as_version=4)

# HTMLExporter ile dönüştür
html_exporter = HTMLExporter()
html_exporter.exclude_input = False
html_exporter.exclude_output_prompt = True
html_exporter.exclude_input_prompt = True

(body, _) = html_exporter.from_notebook_node(notebook)

# Ekstra CSS: tablolar, kod blokları ve uzun çıktılar düzgün sığsın diye
extra_css = """
<style>
body {
    font-size: 11pt;
    margin: 1cm;
}
.output_area pre, .output_html {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
}
table {
    width: 100% !important;
    table-layout: fixed;
    border-collapse: collapse;
}
td, th {
    word-wrap: break-word;
    padding: 4px;
    border: 1px solid #ccc;
}
</style>
"""

# HTML çıktısını birleştir
full_html = f"<!DOCTYPE html><html><head>{extra_css}</head><body>{body}</body></html>"

# HTML dosyasını isteğe bağlı kaydet
with open(HTML_PATH, "w", encoding="utf-8") as f:
    f.write(full_html)

# HTML'den PDF oluştur
HTML(string=full_html).write_pdf(PDF_PATH)

print(f"✅ PDF başarıyla oluşturuldu: {PDF_PATH}")
