import os
import asyncio
from pyppeteer import launch

# İndirilecek dosya adları listesi
notebook_names = [
    "notebook1.ipynb",
    "notebook2.ipynb",
    "notebook3.ipynb"  # Gerekirse daha fazla dosya ekleyin
]

async def download_notebooks():
    # JupyterHub adresinizi belirtin
    jupyterhub_url = "http://localhost:8000/tree/YOUR_DIRECTORY_PATH"

    # Pyppeteer ile Chrome başlatılıyor
    browser = await launch(
        executablePath='/veri01/chrome-linux/chrome',  # Chrome’un sunucudaki yolu
        headless=True,
        args=['--no-sandbox']
    )
    
    page = await browser.newPage()
    await page.goto(jupyterhub_url)  # Doğrudan dosya dizinine gidiyoruz

    # Her bir .ipynb dosyasını indirmek için döngü oluşturuyoruz
    for notebook in notebook_names:
        file_xpath = f'//a[contains(@href, "{notebook}")]'  # Notebook dosyasının XPath'ini bul
        await page.waitForXPath(file_xpath)
        
        # Dosyanın bağlantısına tıklayarak açıyoruz
        elements = await page.xpath(file_xpath)
        if elements:
            await elements[0].click()
            await page.waitForNavigation()

            # Notebook'u kaydediyoruz ve indiriyoruz
            await page.click('button[data-jupyter-action="save-notebook"]')
            await asyncio.sleep(2)  # Bekleme süresi ekleyerek güvenlik sağlıyoruz
            await page.click('button[data-jupyter-action="download-notebook"]')
            await asyncio.sleep(5)

            print(f"{notebook} başarıyla indirildi!")
            await page.goBack()  # Sonraki dosyaya geçmek için geri dön

    await browser.close()

# Asenkron işlemi başlat
asyncio.get_event_loop().run_until_complete(download_notebooks())
