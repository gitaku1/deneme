import os
import asyncio
import nest_asyncio
from pyppeteer import launch

# Jupyter Notebook’un asenkron döngüsüne uyum sağla
nest_asyncio.apply()

# 📂 Kullanıcıdan dizinleri al
IPYNB_PATH = "/veri01/ipynbdirectory/notebook.ipynb"  # Kullanıcının belirttiği `.ipynb` dosyası
CHROME_PATH = "/veri01/chrome-linux/chrome"  # Kullanıcının belirttiği Chrome dizini
PDF_OUTPUT_PATH = "/veri01/ipynbdirectory/notebook.pdf"  # Çıkacak PDF dosyası

# `.ipynb` dosyasını PDF formatına dönüştür
def convert_ipynb_to_pdf():
    os.system(f"jupyter nbconvert --to pdf {IPYNB_PATH} --output {PDF_OUTPUT_PATH}")

async def download_pdf():
    # 🚀 **Chrome başlatılıyor**
    browser = await launch(
        executablePath=CHROME_PATH,  
        headless=True,
        args=['--no-sandbox']
    )

    page = await browser.newPage()

    # 📂 PDF dosyasını aç ve indir
    await page.goto(f"file://{PDF_OUTPUT_PATH}")
    await asyncio.sleep(2)
    print(f"📥 PDF başarıyla indirildi: {PDF_OUTPUT_PATH}")

    await browser.close()

# ✅ **Kodun Jupyter ile uyumlu çalışmasını sağla**
async def main():
    convert_ipynb_to_pdf()  # 📝 `.ipynb` dosyasını PDF'ye dönüştür
    await download_pdf()  # ⬇️ PDF'yi indir

asyncio.run(main())  # Yeni bir asenkron döngü başlat
