#!/bin/bash

# Üst dizini alıyoruz
parent_dir=$1

# Çıktı dosyasının adı
output_file="output.txt"

# 2023 yılına kadar olanları kontrol edeceğiz
year_cutoff=2023

# Çıktı dosyasını sıfırlıyoruz (varsa eski içerikleri temizliyoruz)
> "$output_file"

# Eğer üst dizin verilmediyse hata mesajı veriyoruz
if [ -z "$parent_dir" ]; then
    echo "Lütfen bir üst dizin belirtin."
    exit 1
fi

# Üst dizin geçerli bir dizin mi kontrol ediyoruz
if [ ! -d "$parent_dir" ]; then
    echo "Verilen dizin mevcut değil: $parent_dir"
    exit 1
fi

# Alt dizinlerde gezerek, 2023'ten önce oluşturulmuş olanları listeliyoruz
find "$parent_dir" -type d | while read dir; do
    # Dizin oluşturulma zamanını alıyoruz
    creation_time=$(stat -c %W "$dir")
    
    # Eğer oluşturulma tarihi 0 ise (dizin oluşturulmamış veya dosya sisteminde bilgi yok), geçiyoruz
    if [ "$creation_time" -eq 0 ]; then
        continue
    fi

    # Tarihi insan okuyabileceği bir biçime dönüştürüyoruz
    creation_year=$(date -d @$creation_time +"%Y")

    # Eğer tarih 2023'ten önceyse, çıktıya yazıyoruz
    if [ "$creation_year" -lt "$year_cutoff" ]; then
        echo "$dir" >> "$output_file"
    fi
done

echo "2023 öncesi oluşturulmuş dizinler output.txt dosyasına yazıldı."
