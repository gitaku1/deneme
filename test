import os
import asyncio
import nest_asyncio
from pyppeteer import launch

# Jupyter Notebookâ€™un asenkron dÃ¶ngÃ¼sÃ¼ne uyum saÄŸla
nest_asyncio.apply()

# ğŸ“‚ **Ä°ndirilecek dosya dizini**
jupyterhub_url = "http://localhost:8000/tree/YOUR_DIRECTORY_PATH"

# ğŸ¯ **Ä°ndirilecek dosya listesi**
notebook_names = [
    "notebook1.ipynb",
    "notebook2.ipynb",
    "notebook3.ipynb"  # Daha fazla dosya ekleyebilirsiniz
]

async def download_notebooks():
    # ğŸš€ **Chrome baÅŸlatÄ±lÄ±yor**
    browser = await launch(
        executablePath='/veri01/chrome-linux/chrome',  # Sunucudaki Chromeâ€™un yolu
        headless=True,
        args=['--no-sandbox']
    )

    page = await browser.newPage()
    await page.goto(jupyterhub_url)  # Ana dizine git

    # ğŸ”„ **Her dosya iÃ§in indirme iÅŸlemi**
    for notebook in notebook_names:
        file_xpath = f'//a[contains(@href, "{notebook}")]'
        await page.waitForXPath(file_xpath)

        elements = await page.xpath(file_xpath)
        if elements:
            await elements[0].click()  # ğŸ“‚ DosyayÄ± aÃ§
            await page.waitForNavigation()

            # ğŸ’¾ Notebook'u kaydet
            await page.click('button[data-jupyter-action="save-notebook"]')
            await asyncio.sleep(2)

            # â¬‡ï¸ DosyayÄ± indir
            await page.click('button[data-jupyter-action="download-notebook"]')
            await asyncio.sleep(5)

            print(f"{notebook} baÅŸarÄ±yla indirildi!")
            await page.goBack()  # Bir sonraki dosya iÃ§in geri dÃ¶n

    await browser.close()

# âœ… **Kodun Jupyter ile uyumlu Ã§alÄ±ÅŸmasÄ±nÄ± saÄŸla**
async def main():
    await download_notebooks()

asyncio.run(main())  # Yeni bir asenkron dÃ¶ngÃ¼ baÅŸlat
