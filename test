import os
import asyncio
import nest_asyncio
from pyppeteer import launch

# Jupyter Notebook uyumluluğunu sağla
nest_asyncio.apply()

# İndirilecek dosya adları listesi
notebook_names = [
    "notebook1.ipynb",
    "notebook2.ipynb",
    "notebook3.ipynb"  # Gerekirse daha fazla dosya ekleyin
]

async def download_notebooks():
    jupyterhub_url = "http://localhost:8000/tree/YOUR_DIRECTORY_PATH"

    # Pyppeteer ile Chrome başlatılıyor
    browser = await launch(
        executablePath='/veri01/chrome-linux/chrome',  
        headless=True,
        args=['--no-sandbox']
    )
    
    page = await browser.newPage()
    await page.goto(jupyterhub_url)

    for notebook in notebook_names:
        file_xpath = f'//a[contains(@href, "{notebook}")]'
        await page.waitForXPath(file_xpath)
        
        elements = await page.xpath(file_xpath)
        if elements:
            await elements[0].click()
            await page.waitForNavigation()

            await page.click('button[data-jupyter-action="save-notebook"]')
            await asyncio.sleep(2)
            await page.click('button[data-jupyter-action="download-notebook"]')
            await asyncio.sleep(5)

            print(f"{notebook} başarıyla indirildi!")
            await page.goBack()

    await browser.close()

# Jupyter ile uyumlu şekilde çalıştır
asyncio.create_task(download_notebooks())
