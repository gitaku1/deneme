import os
import asyncio
import nest_asyncio
from pyppeteer import launch

nest_asyncio.apply()

IPYNB_PATH = "/veri01/ipynbdirectory/notebook.ipynb"
HTML_OUTPUT_PATH = "/veri01/ipynbdirectory/notebook.html"
PDF_OUTPUT_PATH = "/veri01/ipynbdirectory/notebook.pdf"
CHROME_PATH = "/veri01/chrome-linux/chrome"

# `.ipynb` dosyasƒ±nƒ± HTML'e √ßevir
def convert_ipynb_to_html():
    os.system(f"jupyter nbconvert --to html {IPYNB_PATH} --output {HTML_OUTPUT_PATH}")

# HTML'i PDF formatƒ±na d√∂n√º≈üt√ºr (LaTeX kullanmadan!)
def convert_html_to_pdf():
    os.system(f"wkhtmltopdf {HTML_OUTPUT_PATH} {PDF_OUTPUT_PATH}")

async def download_pdf():
    if not os.path.exists(PDF_OUTPUT_PATH):
        print("‚ùå PDF bulunamadƒ±, i≈ülem iptal ediliyor.")
        return

    browser = await launch(executablePath=CHROME_PATH, headless=True, args=['--no-sandbox'])
    page = await browser.newPage()
    await page.goto(f"file://{PDF_OUTPUT_PATH}")
    await asyncio.sleep(2)
    print(f"üì• PDF ba≈üarƒ±yla indirildi: {PDF_OUTPUT_PATH}")
    await browser.close()

async def main():
    convert_ipynb_to_html()  # üìù `.ipynb` ‚Üí `.html`
    convert_html_to_pdf()  # üìù `.html` ‚Üí `.pdf`
    await download_pdf()  # ‚¨áÔ∏è PDF'yi indir

asyncio.run(main())
