import os
import asyncio
import nest_asyncio
from pyppeteer import launch

# Jupyter Notebookâ€™un asenkron dÃ¶ngÃ¼sÃ¼ne uyum saÄŸla
nest_asyncio.apply()

# ğŸ“‚ KullanÄ±cÄ±dan dizinleri al
IPYNB_PATH = "/veri01/ipynbdirectory/notebook.ipynb"  # KullanÄ±cÄ±nÄ±n belirttiÄŸi `.ipynb` dosyasÄ±
CHROME_PATH = "/veri01/chrome-linux/chrome"  # KullanÄ±cÄ±nÄ±n belirttiÄŸi Chrome dizini
PDF_OUTPUT_PATH = "/veri01/ipynbdirectory/notebook.pdf"  # Ã‡Ä±kacak PDF dosyasÄ±

# `.ipynb` dosyasÄ±nÄ± PDF formatÄ±na dÃ¶nÃ¼ÅŸtÃ¼r
def convert_ipynb_to_pdf():
    os.system(f"jupyter nbconvert --to pdf {IPYNB_PATH} --output {PDF_OUTPUT_PATH}")

async def download_pdf():
    # ğŸš€ **Chrome baÅŸlatÄ±lÄ±yor**
    browser = await launch(
        executablePath=CHROME_PATH,  
        headless=True,
        args=['--no-sandbox']
    )

    page = await browser.newPage()

    # ğŸ“‚ PDF dosyasÄ±nÄ± aÃ§ ve indir
    await page.goto(f"file://{PDF_OUTPUT_PATH}")
    await asyncio.sleep(2)
    print(f"ğŸ“¥ PDF baÅŸarÄ±yla indirildi: {PDF_OUTPUT_PATH}")

    await browser.close()

# âœ… **Kodun Jupyter ile uyumlu Ã§alÄ±ÅŸmasÄ±nÄ± saÄŸla**
async def main():
    convert_ipynb_to_pdf()  # ğŸ“ `.ipynb` dosyasÄ±nÄ± PDF'ye dÃ¶nÃ¼ÅŸtÃ¼r
    await download_pdf()  # â¬‡ï¸ PDF'yi indir

asyncio.run(main())  # Yeni bir asenkron dÃ¶ngÃ¼ baÅŸlat
